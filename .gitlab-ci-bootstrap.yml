stages:
  - bootstrap

bootstrap-infra:
  stage: bootstrap
  image: hashicorp/terraform:latest
  script:
    - cd terraform/bootstrap
    - terraform init
    - terraform apply -auto-approve
    - terraform output -json > ../../bootstrap_outputs.json
  artifacts:
    paths:
      - bootstrap_outputs.json
  only:
    - main  # Run once for production